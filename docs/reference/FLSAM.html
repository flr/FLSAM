<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>FLR Wrapper for the State-space assessment model (FLSAM)
 — FLSAM • FLSAM</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">FLSAM</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://github.com/flr/FLSAM">
    <span class="fa fa-github fa-lg"></span>
     
    Source
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://flr-project.org/">FLR</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>FLR Wrapper for the State-space assessment model (FLSAM)
</h1>
    </div>

    
    <p>Performs a stock assessment using the State-Space assessment model (SAM)</p>
    

    <pre><span class='fu'>FLSAM</span>(<span class='no'>stck</span>, <span class='no'>tun</span>, <span class='no'>ctrl</span>, <span class='kw'>run.dir</span><span class='kw'>=</span><span class='fu'>tempdir</span>(), <span class='kw'>batch.mode</span><span class='kw'>=</span><span class='fl'>FALSE</span>,<span class='kw'>pin.sam</span><span class='kw'>=</span><span class='kw'>NULL</span>)

<span class='fu'>update</span>(<span class='no'>object</span>, <span class='no'>stck</span>, <span class='no'>tun</span>, <span class='kw'>run.dir</span><span class='kw'>=</span><span class='fu'>tempdir</span>(),<span class='kw'>batch.mode</span><span class='kw'>=</span><span class='fl'>FALSE</span>)

<span class='fu'>FLR2SAM</span>(<span class='no'>stck</span>, <span class='no'>tun</span>, <span class='no'>ctrl</span>, <span class='kw'>run.dir</span> <span class='kw'>=</span> <span class='fu'>tempdir</span>(),<span class='kw'>pin.sam</span><span class='kw'>=</span><span class='kw'>NULL</span>)
<span class='fu'>runSAM</span>(<span class='no'>ctrl</span>, <span class='kw'>run.dir</span><span class='kw'>=</span><span class='fu'>tempdir</span>(),<span class='kw'>use.pin</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
<span class='fu'>SAM2FLR</span>(<span class='kw'>ctrl</span><span class='kw'>=</span><span class='st'>"missing"</span>, <span class='kw'>admb.stem</span><span class='kw'>=</span><span class='st'>"sam"</span>, <span class='kw'>run.dir</span> <span class='kw'>=</span> <span class='fu'>tempdir</span>())</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <dl class="dl-horizontal">
      <dt>stck</dt>
      <dd><code><a href='http://www.rdocumentation.org/packages/FLCore/topics/FLStock'>FLStock</a></code> object containing all data to be used in the assessment
</dd>
      <dt>tun</dt>
      <dd><code><a href='http://www.rdocumentation.org/packages/FLCore/topics/FLIndices'>FLIndices</a></code> object containing survey/tuning indices
</dd>
      <dt>ctrl</dt>
      <dd><code><a href='FLSAM.control.html'>FLSAM.control</a></code> object containing the parameters to be employed in the assessment 
</dd>
      <dt>run.dir</dt>
      <dd>Path to which the temporary files are to be written to or read from. Default is the R temporary directory provided by tempdir()
</dd>
      <dt>batch.mode</dt>
      <dd>Logical variable indicating whether the code should be run in batch mode.
</dd>
      <dt>object</dt>
      <dd>An object of the  <code>FLSAM</code> class, resulting from e.g a call to FLSAM, that is to form the basis for the update.
</dd>
      <dt>pin.sam</dt>
      <dd>Provide an FLSAM object, to be used as pin file, to the FLSAM function call to speed up the estimation process</dd>
      <dt>use.pin</dt>
      <dd>A logical variable indicating whether the SAM executable should look for a file containing initial parameter estimates (i.e. a pin file)</dd>
      <dt>admb.stem</dt>
      <dd>The name of the admb executable (ie without the .dat, .exe etc)</dd>
    </dl>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>FLSAM is an FLR wrapper to SAM, the state-space assessment model. SAM is written in the compiled ADMB language - compiled executables for each platform are included within the FLSAM package. The FLSAM function provides the interface between the data (<code><a href='http://www.rdocumentation.org/packages/FLCore/topics/FLStock'>FLStock</a></code>, <code><a href='http://www.rdocumentation.org/packages/FLCore/topics/FLIndices'>FLIndices</a></code> objects) and configuration objects (<code><a href='FLSAM.control.html'>FLSAM.control</a></code>) stored in R, and the compiled exectable.</p>
    <p>Three helper functions provide the core of the FLSAM method. FLR2SAM accepts the necessary data objects and writes a series of text files to the path specified by run.dir. runSAM takes care of running the SAM executable and checking that the model has run to completion correctly. SAM2FLR reads the outputs generated by the SAM model and reads them back into the FLR environment. The FLSAM function provides a wrapper around these three functions, writing the data to the temporary directory, running the executable, and reading the results back. Generally, the user should not need to use FLR2SAM, runSAM or SAM2FLR, but they can be useful in helping to debug the code.</p>
    <p>SAM2FLR is particularly useful when trying to read results of a SAM run into FLR for plotting, further analysis etc. Ideally it should be able to figure everything out from the contents of the directory containing the files. However, if this fails, it may be necessary to give it a helping hand by creating a  (<code><a href='FLSAM.control.html'>FLSAM.control</a></code>) object and supplying it via the &quot;ctrl&quot; argument.</p>
    <p>The user can also specify the directory (via the &#39;run.dir&#39; argument) in which the temporary files used to communication with SAM are stored. The default is to use the temporary directory of R.</p>
    <p>FLSAM can also be run in &quot;batch-mode&quot; through the &#39;batch.mode&#39; argument. This is a particularly useful feature when running a large number of assessments in an unattended situation. If the SAM model fails to converge in when running in batch-mode, it will suppress the error and return a &quot;NULL&quot; value (instead of an FLSAM object). If the model fails to converge when not running in batch-mode (the default), an error is returned.</p>
    <p>It is also possible, via the &#39;update&#39; function, to &quot;reuse&quot; the results of a previous stock assessment to provide initial guesses for the new assessment. Such a feature may be desirablie in situations where the user is running a large number of assessments that are very similar and have the same parameter configuration e.g. in a management-strategy evaluation. The supplied FLSAM object is used to generate a parameter-initialisation (&quot;pin&quot;) file - the &#39;use.pin&#39; argument in runSAM is then activated in this case, to tell the ADMB SAM executable to use these values. At the moment, it is not possible to change the assessment configuration in this manner - future releases will hopefully incorporate this feature.</p>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The typical return value is an object of the FLSAM class with the following slots.</p>
    <p>The FLSAM function will return an FLSAM object in all cases when the model converges. If the model does not converge, FLSAM will return an error unless it is running in batch mode, in which case it will return &quot;NULL&quot;.</p>
    <p>runSAM() returns an integer error code corresponding to the return value of the SAM model - 0 for a successful run, non-zero otherwise. SAM2FLR will return an FLSAM object. FLR2SAM does not return any values.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Nielsen et al (2012) In prep.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='FLSAM.control.html'>FLSAM.control</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>#Load library</span>
<span class='fu'>library</span>(<span class='no'>FLSAM</span>)
<span class='co'>#Prepare data objects</span>
<span class='fu'>data</span>(<span class='no'>NSH</span>)
<span class='fu'>data</span>(<span class='no'>NSH.sam</span>)
<span class='co'>#Perform assessment</span>
<span class='co'>#Takes about two minutes on a 2.4GHz workstation</span>
<span class='no'>sam</span> <span class='kw'>&lt;-</span> <span class='fu'>FLSAM</span>(<span class='no'>NSH</span>,<span class='no'>NSH.tun</span>,<span class='no'>NSH.ctrl</span>)</div><div class='output co'>#&gt; <span class='error'>Error in attributes(x) &lt;- `*vtmp*`: length of &#39;dimnames&#39; [1] not equal to array extent</span></div><div class='input'>
<span class='co'>#If you want to re-use the sam object to create a pin file, use this:</span>
<span class='no'>sam</span> <span class='kw'>&lt;-</span> <span class='fu'>FLSAM</span>(<span class='no'>NSH</span>,<span class='no'>NSH.tun</span>,<span class='no'>NSH.ctrl</span>,<span class='kw'>pin.sam</span><span class='kw'>=</span><span class='no'>sam</span>)</div><div class='output co'>#&gt; <span class='error'>Error in attributes(x) &lt;- `*vtmp*`: length of &#39;dimnames&#39; [1] not equal to array extent</span></div><div class='input'><span class='co'>#View results</span>
<span class='fu'>plot</span>(<span class='no'>sam</span>)</div><div class='output co'>#&gt; <span class='error'>Error in plot(sam): object &#39;sam&#39; not found</span></div><div class='input'>
<span class='co'>#Repeat the assessment using the previous result as an initial guess</span>
<span class='no'>uninit.time</span> <span class='kw'>&lt;-</span> <span class='fu'>system.time</span>(<span class='no'>sam.uninit</span> <span class='kw'>&lt;-</span> <span class='fu'>FLSAM</span>(<span class='no'>NSH</span>,<span class='no'>NSH.tun</span>,<span class='no'>NSH.ctrl</span>))</div><div class='output co'>#&gt; <span class='error'>Error in attributes(x) &lt;- `*vtmp*`: length of &#39;dimnames&#39; [1] not equal to array extent</span></div><div class='output co'>#&gt; <span class='message'>Timing stopped at: 0.102 0 0.102</span></div><div class='input'><span class='no'>init.time</span>   <span class='kw'>&lt;-</span> <span class='fu'>system.time</span>(<span class='no'>sam.init</span>   <span class='kw'>&lt;-</span> <span class='fu'>update</span>(<span class='no'>sam.uninit</span>,<span class='no'>NSH</span>,<span class='no'>NSH.tun</span>))</div><div class='output co'>#&gt; <span class='error'>Error in update(sam.uninit, NSH, NSH.tun): object &#39;sam.uninit&#39; not found</span></div><div class='output co'>#&gt; <span class='message'>Timing stopped at: 0 0 0</span></div><div class='input'><span class='co'>#Big speed increase! (your results may vary: ours are about 2x)</span>
<span class='no'>uninit.time</span>[<span class='fl'>3</span>]/<span class='no'>init.time</span>[<span class='fl'>3</span>]</div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object &#39;uninit.time&#39; not found</span></div><div class='input'><span class='co'>#But assessments are the sam (phew!)</span>
<span class='fu'>plot</span>(<span class='fu'><a href='FLSAMs-class.html'>FLSAMs</a></span>(<span class='kw'>uninitialised</span><span class='kw'>=</span><span class='no'>sam.uninit</span>,<span class='kw'>initialised</span><span class='kw'>=</span><span class='no'>sam.init</span>))</div><div class='output co'>#&gt; <span class='error'>Error in FLSAMs(uninitialised = sam.uninit, initialised = sam.init): object &#39;sam.uninit&#39; not found</span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
SAM2FLR based on code by Anders Nielsen and adapted by Mark Payne. FLR2SAM and FLSAM by Mark Payne

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by M.R. Payne, N.T. Hintzen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
