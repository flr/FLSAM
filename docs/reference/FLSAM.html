<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>FLR Wrapper for the State-space assessment model (FLSAM)
<!-- %%  ~~function to do ... ~~ --> — FLSAM • FLSAM</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="FLR Wrapper for the State-space assessment model (FLSAM)
<!-- %%  ~~function to do ... ~~ --> — FLSAM" />
<meta property="og:description" content="Performs a stock assessment using the State-Space assessment model (SAM)" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FLSAM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://github.com/flr/FLSAM">
    <span class="fa fa-github fa-lg"></span>
     
    Source
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://flr-project.org/">FLR</a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>FLR Wrapper for the State-space assessment model (FLSAM)
<!-- %%  ~~function to do ... ~~ --></h1>
    
    <div class="hidden name"><code>FLSAM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Performs a stock assessment using the State-Space assessment model (SAM)</p>
    </div>

    <pre class="usage"><span class='fu'>FLSAM</span>(<span class='no'>stck</span>, <span class='no'>tun</span>, <span class='no'>ctrl</span>, <span class='kw'>run.dir</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span>(), <span class='kw'>batch.mode</span><span class='kw'>=</span><span class='fl'>FALSE</span>,<span class='kw'>pin.sam</span><span class='kw'>=</span><span class='kw'>NULL</span>)

<span class='fu'>update</span>(<span class='no'>object</span>, <span class='no'>stck</span>, <span class='no'>tun</span>, <span class='kw'>run.dir</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span>(),<span class='kw'>batch.mode</span><span class='kw'>=</span><span class='fl'>FALSE</span>)

<span class='fu'>FLR2SAM</span>(<span class='no'>stck</span>, <span class='no'>tun</span>, <span class='no'>ctrl</span>, <span class='kw'>run.dir</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span>(),<span class='kw'>pin.sam</span><span class='kw'>=</span><span class='kw'>NULL</span>)
<span class='fu'>runSAM</span>(<span class='no'>ctrl</span>, <span class='kw'>run.dir</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span>(),<span class='kw'>use.pin</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
<span class='fu'>SAM2FLR</span>(<span class='kw'>ctrl</span><span class='kw'>=</span><span class='st'>"missing"</span>, <span class='kw'>admb.stem</span><span class='kw'>=</span><span class='st'>"sam"</span>, <span class='kw'>run.dir</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span>())</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>stck</th>
      <td><p><code><a href='https://rdrr.io/pkg/FLCore/man/FLStock.html'>FLStock</a></code> object containing all data to be used in the assessment</p></td>
    </tr>
    <tr>
      <th>tun</th>
      <td><p><code><a href='https://rdrr.io/pkg/FLCore/man/FLIndices.html'>FLIndices</a></code> object containing survey/tuning indices</p></td>
    </tr>
    <tr>
      <th>ctrl</th>
      <td><p><code><a href='FLSAM.control.html'>FLSAM.control</a></code> object containing the parameters to be employed in the assessment</p></td>
    </tr>
    <tr>
      <th>run.dir</th>
      <td><p>Path to which the temporary files are to be written to or read from. Default is the R temporary directory provided by tempdir()</p></td>
    </tr>
    <tr>
      <th>batch.mode</th>
      <td><p>Logical variable indicating whether the code should be run in batch mode.</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>An object of the  <code>FLSAM</code> class, resulting from e.g a call to FLSAM, that is to form the basis for the update.</p></td>
    </tr>
    <tr>
      <th>pin.sam</th>
      <td><p>Provide an FLSAM object, to be used as pin file, to the FLSAM function call to speed up the estimation process</p></td>
    </tr>
    <tr>
      <th>use.pin</th>
      <td><p>A logical variable indicating whether the SAM executable should look for a file containing initial parameter estimates (i.e. a pin file)</p></td>
    </tr>
    <tr>
      <th>admb.stem</th>
      <td><p>The name of the admb executable (ie without the .dat, .exe etc)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>FLSAM is an FLR wrapper to SAM, the state-space assessment model. SAM is written in the compiled ADMB language - compiled executables for each platform are included within the FLSAM package. The FLSAM function provides the interface between the data (<code><a href='https://rdrr.io/pkg/FLCore/man/FLStock.html'>FLStock</a></code>, <code><a href='https://rdrr.io/pkg/FLCore/man/FLIndices.html'>FLIndices</a></code> objects) and configuration objects (<code><a href='FLSAM.control.html'>FLSAM.control</a></code>) stored in R, and the compiled exectable.</p>
<p>Three helper functions provide the core of the FLSAM method. FLR2SAM accepts the necessary data objects and writes a series of text files to the path specified by run.dir. runSAM takes care of running the SAM executable and checking that the model has run to completion correctly. SAM2FLR reads the outputs generated by the SAM model and reads them back into the FLR environment. The FLSAM function provides a wrapper around these three functions, writing the data to the temporary directory, running the executable, and reading the results back. Generally, the user should not need to use FLR2SAM, runSAM or SAM2FLR, but they can be useful in helping to debug the code.</p>
<p>SAM2FLR is particularly useful when trying to read results of a SAM run into FLR for plotting, further analysis etc. Ideally it should be able to figure everything out from the contents of the directory containing the files. However, if this fails, it may be necessary to give it a helping hand by creating a  (<code><a href='FLSAM.control.html'>FLSAM.control</a></code>) object and supplying it via the "ctrl" argument.</p>
<p>The user can also specify the directory (via the 'run.dir' argument) in which the temporary files used to communication with SAM are stored. The default is to use the temporary directory of R.</p>
<p>FLSAM can also be run in "batch-mode" through the 'batch.mode' argument. This is a particularly useful feature when running a large number of assessments in an unattended situation. If the SAM model fails to converge in when running in batch-mode, it will suppress the error and return a "NULL" value (instead of an FLSAM object). If the model fails to converge when not running in batch-mode (the default), an error is returned.</p>
<p>It is also possible, via the 'update' function, to "reuse" the results of a previous stock assessment to provide initial guesses for the new assessment. Such a feature may be desirablie in situations where the user is running a large number of assessments that are very similar and have the same parameter configuration e.g. in a management-strategy evaluation. The supplied FLSAM object is used to generate a parameter-initialisation ("pin") file - the 'use.pin' argument in runSAM is then activated in this case, to tell the ADMB SAM executable to use these values. At the moment, it is not possible to change the assessment configuration in this manner - future releases will hopefully incorporate this feature.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The typical return value is an object of the FLSAM class with the following slots.</p>
<dt>control</dt><dd><p>The <code><a href='FLSAM.control.html'>FLSAM.control</a></code> object used to configure the assessment.</p></dd>
<dt>nohess</dt><dd><p>Logical variable indicating whether the model was fit including the calculation of the hessian</p></dd>
<dt>nopar</dt><dd><p>The number of parameters fitted by the model</p></dd>
<dt>n.states</dt><dd><p>The number of states fitted internally in the model</p></dd>
<dt>states</dt><dd><p>The state coupling matrix - see <code><a href='FLSAM.control.html'>FLSAM.control</a></code></p></dd>
<dt>nlogl</dt><dd><p>The negative log-likelihood of the fitted parameters</p></dd>
<dt>maxgrad</dt><dd><p>The gradient of the negative log-likelihood at optimum</p></dd>
<dt>vcov</dt><dd><p>The variance-covariance matrix of the fitted parameters</p></dd>
<dt>params</dt><dd><p>The parameters fitted by the model, stored as a data.frame. The columns of the data frame are <ul>
<li><p>index - A numeric index for the parameter</p></li>
<li><p>name - The name of parameter</p></li>
<li><p>value The fitted value of the parameter</p></li>
<li><p>std.dev -The standard deviation of the fitted value</p></li>
</ul></p></dd>
<dt>stock.n</dt><dd><p>An <code><a href='https://rdrr.io/pkg/FLCore/man/FLQuant.html'>FLQuant</a></code> object containing the stock-numbers at age in each year</p></dd>
<dt>harvest</dt><dd><p>An <code><a href='https://rdrr.io/pkg/FLCore/man/FLQuant.html'>FLQuant</a></code> object containing the fishing mortality at age in each year</p></dd>
<dt>residuals</dt><dd><p>A data.frame summarising the observed and fitted values, and the residuals linking them. The columns of the data frame are <ul>
<li><p>year - the year in which the observation was made</p></li>
<li><p>fleet - the fleet the observation corresponds to</p></li>
<li><p>age - the age the observation corresponds to. For biomass indices, this value has no meaning</p></li>
<li><p>log.obs - the natural logarithm of the observed value</p></li>
<li><p>log.mdl - the natural logarithm of the modelled value</p></li>
<li><p>std.res - the standardised residual i.e. (log.obs - log.mdl) / obs.std, where obs.std is the observation error associated with that fleet/age.</p></li>
</ul></p></dd>
<dt>name</dt><dd><p>A text field giving the name of the object</p></dd>
<dt>desc</dt><dd><p>A text field describing the object</p></dd>
<dt>range</dt><dd><p>A named vector containg key information about range covered by the object <ul>
<li><p>min - the youngest age modelled</p></li>
<li><p>max - the oldest age modelled (can be a plus group)</p></li>
<li><p>plusgroup - the agegroup considered as a plusgroup (if any)</p></li>
<li><p>minyear - the first year modelled</p></li>
<li><p>maxyear - the last year modelled</p></li>
<li><p>minfbar - the younger limit of ages used in calcualting the average fishing mortality, fbar</p></li>
<li><p>maxfbar - the older limit of ages used in calcualting the average fishing mortality, fbar</p></li>
</ul></p></dd>
<dt>info</dt><dd><p>Contains key information about the software versions and operating system used in running the assessment</p></dd>
The FLSAM function will return an FLSAM object in all cases when the model converges. If the model does not converge, FLSAM will return an error unless it is running in batch mode, in which case it will return "NULL".

runSAM() returns an integer error code corresponding to the return value of the SAM model - 0 for a successful run, non-zero otherwise. SAM2FLR will return an FLSAM object. FLR2SAM does not return any values.

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Nielsen et al (2012) In prep.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='FLSAM.control.html'>FLSAM.control</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>#Load library</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>FLSAM</span>)
<span class='co'>#Prepare data objects</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>NSH</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>NSH.sam</span>)
<span class='co'>#Perform assessment</span>
<span class='co'>#Takes about two minutes on a 2.4GHz workstation</span>
<span class='no'>sam</span> <span class='kw'>&lt;-</span> <span class='fu'>FLSAM</span>(<span class='no'>NSH</span>,<span class='no'>NSH.tun</span>,<span class='no'>NSH.ctrl</span>)</div><div class='output co'>#&gt; <span class='error'>Error in setup.sam.data(surveys = surveysFLR, residual.fleets = residual.fleets,     sum.residual.fleets = sum.fleets, prop.mature = propMat,     stock.mean.weight = stockWeight, catch.mean.weight = catchWeight,     dis.mean.weight = discardWeight, land.mean.weight = landingWeight,     prop.f = propF, prop.m = propM, natural.mortality = natMort,     land.frac = landFrac): unused arguments (residual.fleets = residual.fleets, sum.residual.fleets = sum.fleets)</span></div><div class='input'>
<span class='co'>#If you want to re-use the sam object to create a pin file, use this:</span>
<span class='no'>sam</span> <span class='kw'>&lt;-</span> <span class='fu'>FLSAM</span>(<span class='no'>NSH</span>,<span class='no'>NSH.tun</span>,<span class='no'>NSH.ctrl</span>,<span class='kw'>pin.sam</span><span class='kw'>=</span><span class='no'>sam</span>)</div><div class='output co'>#&gt; <span class='error'>Error in setup.sam.data(surveys = surveysFLR, residual.fleets = residual.fleets,     sum.residual.fleets = sum.fleets, prop.mature = propMat,     stock.mean.weight = stockWeight, catch.mean.weight = catchWeight,     dis.mean.weight = discardWeight, land.mean.weight = landingWeight,     prop.f = propF, prop.m = propM, natural.mortality = natMort,     land.frac = landFrac): unused arguments (residual.fleets = residual.fleets, sum.residual.fleets = sum.fleets)</span></div><div class='input'><span class='co'>#View results</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>sam</span>)</div><div class='output co'>#&gt; <span class='error'>Error in plot(sam): object 'sam' not found</span></div><div class='input'>
<span class='co'>#Repeat the assessment using the previous result as an initial guess</span>
<span class='no'>uninit.time</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>sam.uninit</span> <span class='kw'>&lt;-</span> <span class='fu'>FLSAM</span>(<span class='no'>NSH</span>,<span class='no'>NSH.tun</span>,<span class='no'>NSH.ctrl</span>))</div><div class='output co'>#&gt; <span class='error'>Error in setup.sam.data(surveys = surveysFLR, residual.fleets = residual.fleets,     sum.residual.fleets = sum.fleets, prop.mature = propMat,     stock.mean.weight = stockWeight, catch.mean.weight = catchWeight,     dis.mean.weight = discardWeight, land.mean.weight = landingWeight,     prop.f = propF, prop.m = propM, natural.mortality = natMort,     land.frac = landFrac): unused arguments (residual.fleets = residual.fleets, sum.residual.fleets = sum.fleets)</span></div><div class='output co'>#&gt; <span class='message'>Timing stopped at: 0.057 0 0.057</span></div><div class='input'><span class='no'>init.time</span>   <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>sam.init</span>   <span class='kw'>&lt;-</span> <span class='fu'>update</span>(<span class='no'>sam.uninit</span>,<span class='no'>NSH</span>,<span class='no'>NSH.tun</span>,<span class='no'>NSH.ctrl</span>))</div><div class='output co'>#&gt; <span class='error'>Error in update(sam.uninit, NSH, NSH.tun, NSH.ctrl): object 'sam.uninit' not found</span></div><div class='output co'>#&gt; <span class='message'>Timing stopped at: 0 0 0</span></div><div class='input'><span class='co'>#Big speed increase! (your results may vary: ours are about 2x)</span>
<span class='no'>uninit.time</span>[<span class='fl'>3</span>]/<span class='no'>init.time</span>[<span class='fl'>3</span>]</div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'uninit.time' not found</span></div><div class='input'><span class='co'>#But assessments are the sam (phew!)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='fu'><a href='FLSAMs.html'>FLSAMs</a></span>(<span class='kw'>uninitialised</span><span class='kw'>=</span><span class='no'>sam.uninit</span>,<span class='kw'>initialised</span><span class='kw'>=</span><span class='no'>sam.init</span>))</div><div class='output co'>#&gt; <span class='error'>Error in FLSAMs(uninitialised = sam.uninit, initialised = sam.init): object 'sam.uninit' not found</span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>SAM2FLR based on code by Anders Nielsen and adapted by Mark Payne. FLR2SAM and FLSAM by Mark Payne</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by N.T. Hintzen, M.R. Payne.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


